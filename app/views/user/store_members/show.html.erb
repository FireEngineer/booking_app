<h1>会員詳細<<small><%= @store_member.name %>様</small>></h1>

<div class="card border-primary mb-3">
  <a class="display_open_btn" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
    <div class="card-header">
      会員情報(<i class="fas fa-angle-double-down"></i>)
    </div>
  </a>
  <div class="card-body collapse" id="collapseExample">
    <blockquote class="blockquote mb-0 member_edit_form">
      <%= form_for @store_member, url: calendar_store_member_path(@calendar, @store_member) do |f| %>
          <table class="table table-borderless table-sm">
            <tbody>
              <tr>
                <th class="col-xs-2"><i class="fas fa-phone-square fa-2x"></i></th>
                <td class="col-xs-10"><%= @store_member.phone %></td>
              </tr>
              <tr>
                <th class="col-xs-2"><i class="far fa-envelope fa-2x"></i></th>
                <td class="col-xs-10"><%= @store_member.email %></td>
              </tr>
              <tr>
                <th class="col-xs-2">メモ</th>
                <td class="col-xs-10">
                  <p class="disabled_form"><%= @store_member.memo %></p>
                  <P class="display_none">
                    <%= f.text_area :memo, class: "form-control form_style display_none memo_text_area" %>
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        <button type="button" class="btn btn-success" id="start_edit_btn">編集する</button>
        <%= f.submit "更新", class:"btn btn-primary display_none", data: {confirm: "内容を更新しますか？"} %>
      <% end %>
    </blockquote>
  </div>
</div>


  <div class="card">
    <% prev_task = @tasks.prev_task.first %>
    <a class="display_open_btn" data-toggle="collapse" href="#collapseExample2" role="button" aria-expanded="false" aria-controls="collapseExample">
      <div class="card-header">
        前回の予約(<i class="fas fa-angle-double-down"></i>)
      </div>
    </a>
    <div class="card-body collapse" id="collapseExample2">
      <table class="table table-borderless table-sm">
        <% if prev_task %>
          <tbody>
            <tr>
              <th scope="row">時間</th>
              <td><%= reservation_date(prev_task) %></td>
            </tr>
            <tr>
              <th scope="row">コース</th>
              <td><%= prev_task.task_course.title %></td>
            </tr>
            <tr>
              <th scope="row">ご要望</th>
              <td><%= prev_task.request %></td>
            </tr>
            <tr>
              <th scope="row">メモ</th>
              <td><%= prev_task.memo %></td>
            </tr>
          </tbody>
        <% end %>
      </table>
    </div>
  </div>
  <div class="card border-info">
    <% today_tasks = @tasks.member_tasks(@store_member).today_tasks %>
    <a class="display_open_btn" data-toggle="collapse" href="#collapseExample3" role="button" aria-expanded="false" aria-controls="collapseExample">
      <div class="card-header">本日の予約 : <%= today_tasks.size %>件 (<i class="fas fa-angle-double-down"></i>)</div>
    </a>
    <div class="card-body text-info collapse" id="collapseExample3">
      <table class="table table-borderless table-sm">
        <% today_tasks.each do |task| %>
          <tbody>
            <tr>
              <th scope="row">時間</th>
              <td><%= reservation_date(task) %></td>
            </tr>
            <tr>
              <th scope="row">コース</th>
              <td><%= task.task_course.title %></td>
            </tr>
            <tr>
              <th scope="row">ご要望</th>
              <td><%= task.request %></td>
            </tr>
            <tr>
              <th scope="row">メモ</th>
              <td><%= simple_format(task.memo) %></td>
            </tr>
          </tbody>
        <% end %>
      </table>
    </div>
  </div>
  <div class="card">
    <% next_task = @tasks.next_task.first %>
    <a class="display_open_btn" data-toggle="collapse" href="#collapseExample4" role="button" aria-expanded="false" aria-controls="collapseExample">
      <div class="card-header">
        次回の予約(<i class="fas fa-angle-double-down"></i>)
      </div>
    </a>
    <div class="card-body collapse" id="collapseExample4">
      <table class="table table-borderless table-sm">
        <% if next_task %>
          <tbody>
            <tr>
              <th scope="row">時間</th>
              <td><%= reservation_date(next_task) %></td>
            </tr>
            <tr>
              <th scope="row">コース</th>
              <td><%= next_task.task_course.title %></td>
            </tr>
            <tr>
              <th scope="row">ご要望</th>
              <td><%= next_task.request %></td>
            </tr>
            <tr>
              <th scope="row">メモ</th>
              <td><%= next_task.memo %></td>
            </tr>
          </tbody>
        <% end %>
      </table>
    </div>
  </div>


<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">開始時間</th>
      <th scope="col">終了時間</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <th scope="row"><%= l(task.start_time, format: :long) %></th>
        <td><%= l(task.end_time, format: :long) %></td>
        <td>
          <%= link_to "詳細", calendar_store_member_task_show_path(@calendar, task), class:"btn btn-primary", remote: :true %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<div id="member_task_modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>


<script>
  // ボタンを押して、編集が可能になる
  $('#start_edit_btn').on('click', function() {
    $('.member_edit_form').find(".disabled_form").css("display","none")
    $('.member_edit_form').find(".display_none").removeClass("display_none");
    $(this).remove();
  });
</script>