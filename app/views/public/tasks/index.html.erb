<div class="top_page">
  <div class="title">
    <h2 class="title_style mt-3">予約フォーム</h2>
  </div>
  
  <% if browser.device.mobile?  %>
    <%= render 'select_area_sp' %>
  <% else %>
    <%= render 'select_area' %>
  <% end %>

  <%= paginate @month %>
		<div id="public_task_index">
    <div id="jsRsvCdTbl" class="reserveConditionTable  jscInnerTableWrap">
				<p class="fgRed fs10 mT5 mB5">※来店日条件：指定なし</p>
				<table class="innerTable nowrap jscInnerTable" cellpadding="0" cellspacing="0">
					<thead>
						<tr>
							<th rowspan="2" class="weekPaging">
								<span class="arrowPagingWeekLOff">前の一週間</span>
							</th>
							<th colspan="14" class="monthCell">2020年1月</th>
							<th rowspan="2" class="weekPaging">
								<a href="https://beauty.hotpepper.jp/CSP/bt/reserve/salonSchedule?storeId=H000366135&amp;week=1" title="次の一週間" class="arrowPagingWeekR jscCalNavi">次の一週間</a>
							</th>
						</tr>
						<tr class="dayCellContainer">
							<% @month.each do |day| %>
								<th class="dayCell">
									<%= l(day, format: :top) %>
								</th>
							<% end %>
						</tr>
					</thead>
					<tbody>
						<tr>
							<th>
								<table cellpadding="0" cellspacing="0" class="moreInnerTable timeTableLeft">
									<tbody>
										<% @times.each do |time| %>
											<tr>
												<th class="timeCell timeSharpLine"><%= l( time, format: :very_short) %></th>
											</tr>
										<% end %>
										<%# <tr>
											<th class="timeCell ">9：30</th>
										</tr> %>
									</tbody>
								</table>
							</th>
							<% @month.each do |day| %>
								<% ok_term = StaffTaskToJsonOutputer.public_staff_shifts(@staffs, day.all_day) %>
								<%# GoogleEventsToJsonOutputer.public_staff_private(@staffs, day.all_day) %>
								<% not_term = not_term(@staffs, day.all_day) %>
								
								<th class="closeCol">
									<table cellpadding="0" cellspacing="0" class="moreInnerTable">
										<tbody>
											<% @times.each do |time| %>
												<% start_time = DateTime.parse(time(day, time)) %>
												<%# debugger %>
												<% end_time = start_time.since((@task_course.course_time + @calendar_config.interval_time).minutes) %>
												<% if @regular_holiday_days.include?(@dw[day.wday]) %>
												
													<tr>
														<td class="closeColInner">
															<span class="closeColText">休業日</span>
														</td>
													</tr>
												<% elsif include_shift?(ok_term, start_time, end_time) == "ok" && invalid_time?(not_term, start_time, end_time) == "ok" %>
													<tr>
														<td class="openCell timeSharpLine">
															<th class="timeCell timeSharpLine">
																<a href="https://beauty.hotpepper.jp/CSP/bt/reserve/afterSchedule?storeId=H000366135&amp;rsvRequestDate1=20200108&amp;rsvRequestTime1=0900" class="icnOpen">◎</a>
															</th>
														</td>
													</tr>
												<% else %>
													<tr>
														<td class="openCell timeSharpLine">
															<th class="timeCell timeSharpLine">
																<i class="fas fa-times"></i>
															</th>
														</td>
													</tr>
												<% end %>
											<% end %>
										</tbody>
									</table>
								</th>
							<% end %>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

<script>
  // Chrome76でも見分けられるmishraさんの方法
  async function start() {
      if ("storage" in navigator && "estimate" in navigator.storage) {
          const { usage, quota } = await navigator.storage.estimate();
          console.log(`Using ${usage} out of ${quota} bytes.`);

          if (quota < 120000000) {
              console.log("新調査方法の判定：シークレットモード");
              alert("ブラウザのシークレットモードを解除してください。正常に予約ができない場合があります。");
          } else {
              console.log("新調査方法の判定：通常モード");
          }
      } else {
          console.log("Can not detect");
      }
  }
  start();

  if (window.openDatabase) {
    try {
        localStorage.test = 'hoge';
        
    } catch(e) {
        alert("ブラウザのシークレットモードを解除してください。正常に予約ができない場合があります。");
        window.location.href = "<%= calendar_tasks_url(@calendar) %>"
    }
    }

  $(function(){
  $('tr[data-href]', 'table.table-clickable').on('click', function(){
    location.href = $(this).data('href');
  });
});
</script>

